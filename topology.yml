---
# NetLab OSPF Multi-Area Lab
# ===========================
# Demonstrates the following OSPF area types:
#
#   Area 0 (0.0.0.0) – Backbone
#   Area 1 (0.0.0.1) – Regular (Standard) Area
#   Area 2 (0.0.0.2) – Stub Area
#   Area 3 (0.0.0.3) – Totally Stubby Area
#   Area 4 (0.0.0.4) – Not-So-Stubby Area (NSSA)
#   Area 5 (0.0.0.5) – Totally NSSA (NSSA No-Summary)
#
# Device: FRRouting (FRR) – open-source routing suite
# Provider: Containerlab (clab)

defaults:
  device: frr
  provider: clab

module: [ ospf ]
plugin: [ ospf.areas ]

# All nodes default to Area 0 (backbone) unless overridden at node level.
# The ospf.areas plugin auto-configures stub, totally-stubby, NSSA, and
# totally-NSSA area types on every router in the respective area.
ospf:
  area: 0.0.0.0
  areas:
    - area: 0.0.0.2           # Stub
      kind: stub
    - area: 0.0.0.3           # Totally Stubby
      kind: stub
      inter_area: false
    - area: 0.0.0.4           # NSSA
      kind: nssa
    - area: 0.0.0.5           # Totally NSSA
      kind: nssa
      inter_area: false

nodes:

  # ── Area 0: Backbone ────────────────────────────────────────────────────────
  bb:

  # ── Area Border Routers (ABRs) ──────────────────────────────────────────────
  abr1:   # Area 0 ↔ Area 1 (Regular)
  abr2:   # Area 0 ↔ Area 2 (Stub)
  abr3:   # Area 0 ↔ Area 3 (Totally Stubby)
  abr4:   # Area 0 ↔ Area 4 (NSSA)
  abr5:   # Area 0 ↔ Area 5 (Totally NSSA)

  # ── Area 1: Regular (Standard) Area ─────────────────────────────────────────
  # Receives all LSA types (1-5). Identical behaviour to the backbone area.
  r1:
    ospf:
      area: 0.0.0.1

  # ── Area 2: Stub Area ────────────────────────────────────────────────────────
  # Type-5 (external) LSAs are blocked. The ABR injects a default route instead.
  r2:
    ospf:
      area: 0.0.0.2

  # ── Area 3: Totally Stubby Area ──────────────────────────────────────────────
  # Type-3, -4, and -5 LSAs are all blocked.
  # Only a single default route from the ABR is accepted.
  r3:
    ospf:
      area: 0.0.0.3

  # ── Area 4: Not-So-Stubby Area (NSSA) ───────────────────────────────────────
  # Type-5 LSAs are blocked, but external routes can be imported by an ASBR
  # inside the area as Type-7 LSAs (converted to Type-5 at the ABR).
  # r4 acts as ASBR: the 10.99.0.0/24 link is role:external (not part of OSPF)
  # and is redistributed into OSPF via ospf.import as a Type-7 LSA.
  r4:
    ospf:
      area: 0.0.0.4
      import: [ connected ]

  # ── Area 5: Totally NSSA (NSSA No-Summary) ──────────────────────────────────
  # Like NSSA, Type-5 LSAs are blocked and an ASBR can inject Type-7 LSAs.
  # Additionally, Type-3 inter-area summary LSAs are suppressed (no-summary),
  # so only intra-area routes and one default route reach r5.
  # r5 acts as ASBR: the 10.100.0.0/24 link is role:external (not part of OSPF)
  # and is redistributed into OSPF via ospf.import as a Type-7 LSA.
  r5:
    ospf:
      area: 0.0.0.5
      import: [ connected ]

links:

  # ── Area 0: Backbone LAN (broadcast) ─────────────────────────────────────────
  # All backbone routers share a single broadcast segment.
  # OSPF runs DR/BDR election on this multi-access network.
  - bb:
    abr1:
    abr2:
    abr3:
    abr4:
    abr5:

  # ── Area 1: Regular Area ────────────────────────────────────────────────────
  - abr1:
      ospf:
        area: 0.0.0.1
    r1:

  # ── Area 2: Stub Area ───────────────────────────────────────────────────────
  - abr2:
      ospf:
        area: 0.0.0.2
    r2:

  # ── Area 3: Totally Stubby Area ─────────────────────────────────────────────
  - abr3:
      ospf:
        area: 0.0.0.3
    r3:

  # ── Area 4: NSSA ────────────────────────────────────────────────────────────
  - abr4:
      ospf:
        area: 0.0.0.4
    r4:

  # External network on r4 – role:external excludes this interface from OSPF.
  # ospf.import: [connected] on r4 redistributes it into OSPF as a Type-7 LSA.
  - r4:
    role: external
    prefix: 10.99.0.0/24

  # ── Area 5: Totally NSSA ────────────────────────────────────────────────────
  - abr5:
      ospf:
        area: 0.0.0.5
    r5:

  # External network on r5 – role:external excludes this interface from OSPF.
  # ospf.import: [connected] on r5 redistributes it into OSPF as a Type-7 LSA.
  - r5:
    role: external
    prefix: 10.100.0.0/24
